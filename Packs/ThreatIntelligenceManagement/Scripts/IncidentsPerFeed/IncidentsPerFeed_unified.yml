args:
  - default: false
    description: Additional filters for the 'getIncidents' command
    isArray: false
    name: query
    required: false
    secret: false
  - default: false
    description: Name to display in the widget as the distinct incidents name
    isArray: false
    name: incidents_distinction_name
    required: false
    secret: false
comment: "Return amount of incidents that has indicators from feeds in them.\nOptional-\
  \ a query can be added and the script will then return the incident amount categorized\
  \ by the query.\nMeaning it will display how much of the incidents that came from\
  \ this feed returned from the query. "
commonfields:
  id: IncidentsPerFeed
  version: -1
enabled: true
name: IncidentsPerFeed
script: !!binary |-
  ZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIFVuaW9uCgpGRUVEID0gImZlZWQiCkFDVElWRSA9ICJhY3RpdmUiCgoKZGVmIGdldF9pbmNpZGVudHNfY291bnRfYnlfZmVlZChmZWVkLCBmcm9tX2RhdGUsIHF1ZXJ5PU5vbmUpIC0+IGludDoKICAgICIiIkNvdW50cyB0aGUgaW5jaWRlbnRzIGFtb3VudCB0aGF0IGZpdHMgdGhlIHF1ZXJ5IGFuZCBoYXMgaW5kaWNhdG9ycyB0aGF0IGNhbWUgZnJvbSB0aGUgZ2l2ZW4gZmVlZC4KICAgICAgICBBcmdzOgogICAgICAgICAgICAgICAgZmVlZDogRmVlZCBmcm9tIHdoaWNoIHRoZSBpbmNpZGVudHMgaW5kaWNhdG9yIHNob3VsZCBiZSBmcm9tCiAgICAgICAgICAgICAgICBmcm9tX2RhdGU6IFRoZSBkYXRlIGZyb20gdGhlIGluY2lkZW50cyBzaG91bGQgYmUgcXVlcmllZAogICAgICAgICAgICAgICAgcXVlcnk6IEFkZGl0aW9uYWwgZmlsdGVycyBmb3IgdGhlICdnZXRJbmNpZGVudHMnIGNvbW1hbmQKICAgICAgICBAcmV0dXJuOgogICAgICAgICAgICB0b3RhbCBhbW91bnQgb2YgaW5jaWRlbnRzIHJldHVybmVkLgogICAgIiIiCiAgICBwYXJhbXMgPSBnZW5lcmF0ZV9xdWVyeV9wYXJhbXMoZmVlZCwgZnJvbV9kYXRlLCBxdWVyeSkKICAgIHJlcyA9IGRlbWlzdG8uZXhlY3V0ZUNvbW1hbmQoImdldEluY2lkZW50cyIsIHBhcmFtcykKICAgIHNldmVyZV9pbmNpZGVudHNfY291bnQgPSByZXNbMF1bIkNvbnRlbnRzIl1bInRvdGFsIl0KICAgIHJldHVybiBzZXZlcmVfaW5jaWRlbnRzX2NvdW50CgoKZGVmIGdlbmVyYXRlX3F1ZXJ5X3BhcmFtcyhmZWVkLCBmcm9tX2RhdGUsIHF1ZXJ5KToKICAgICIiIkdlbmVyYXRpbmcgcGFyYW1ldGVycyBmb3IgJ2dldEluY2lkZW50cycgY29tbWFuZCBhY2NvcmRpbmcgdG8gcmVsZXZhbnQgZmVlZCwgZGF0ZSwgYW5kIGFkZGl0aW9uYWwgcXVlcnkKICAgICAgICBBcmdzOgogICAgICAgICAgICAgICAgZmVlZDogRmVlZCBmcm9tIHdoaWNoIHRoZSBpbmNpZGVudHMgaW5kaWNhdG9yIHNob3VsZCBiZSBmcm9tCiAgICAgICAgICAgICAgICBmcm9tX2RhdGU6IFRoZSBkYXRlIGZyb20gdGhlIGluY2lkZW50cyBzaG91bGQgYmUgcXVlcmllZAogICAgICAgICAgICAgICAgcXVlcnk6IEFkZGl0aW9uYWwgZmlsdGVycyBmb3IgdGhlICdnZXRJbmNpZGVudHMnIGNvbW1hbmQKCiAgICAgICAgICAgICAgICBAcmV0dXJuOgogICAgICAgICAgICAgICAgICAgIEEgc2V0IHdpdGggZmVlZCBuYW1lcwogICAgICAgICIiIgogICAgcXVlcnlfc3RyaW5nID0gZidpbmRpY2F0b3Iuc291cmNlQnJhbmRzOntmZWVkfScKICAgIGlmIHF1ZXJ5OgogICAgICAgIHF1ZXJ5X3N0cmluZyArPSBmJyBhbmQge3F1ZXJ5fScKICAgIHBhcmFtcyA9IHsicXVlcnkiOiBxdWVyeV9zdHJpbmd9CiAgICBpZiBmcm9tX2RhdGU6CiAgICAgICAgcGFyYW1zLnVwZGF0ZSh7ImZyb21kYXRlIjogZnJvbV9kYXRlfSkKICAgIHJldHVybiBwYXJhbXMKCgpkZWYgZ2V0X2ZlZWRzKCkgLT4gc2V0OgogICAgIiIi77+/UmV0dXJuIGFsbCBlbmFibGVkIG1vZHVsZXMKICAgICAgICAgICAgQHJldHVybjoKICAgICAgICAgICAgICAgIEEgc2V0IHdpdGggZmVlZCBuYW1lcwogICAgIiIiCiAgICBtb2R1bGVzID0gZGVtaXN0by5nZXRNb2R1bGVzKCkgICMgdHlwZTogaWdub3JlICAjIHB5bGludDogZGlzYWJsZT1FMTEwMQogICAgcmV0dXJuIHttb2R1bGVfZGV0YWlsc1siYnJhbmQiXSBmb3IgaW5zdGFuY2VfbmFtZSwgbW9kdWxlX2RldGFpbHMgaW4gbW9kdWxlcy5pdGVtcygpIGlmIGFjdGl2ZV9mZWVkKG1vZHVsZV9kZXRhaWxzKX0KCgpkZWYgYWN0aXZlX2ZlZWQobW9kdWxlKSAtPiBib29sOgogICAgIiIiQ2hlY2tzIGlmIG1vZHVsZSBpcyBhY3RpdmUgYW5kIGlmIGl0J3MgYSBmZWVkIGFuZCByZXR1cm4gYSBib29sZWFuIGFjY29yZGluZ2x5CiAgICAgICAgICAgIEFyZ3M6CiAgICAgICAgICAgICAgICAgICAgbW9kdWxlOiBNb2R1bGUgdG8gY2hlY2sgaWYgaXMgYWN0aXZlIGZlZWQKICAgICAgICAgICAgQHJldHVybjoKICAgICAgICAgICAgICAgIFRydWUgaWYgdGhlIG1vZHVsZSdzIGJyYW5kIGhhcyAnZmVlZCcgaW4gaXQgYW5kIGlmIG1vZHVsZSAnc3RhdGUgaXMgJ2FjdGl2ZScgZWxzZSBGYWxzZQogICAgIiIiCiAgICByZXR1cm4gRkVFRCBpbiBtb2R1bGVbImJyYW5kIl0ubG93ZXIoKSBhbmQgbW9kdWxlWyJzdGF0ZSJdID09IEFDVElWRQoKCmRlZiBtYWluKCk6CiAgICBmZWVkX3R5cGVzID0gZ2V0X2ZlZWRzKCkKICAgIGRpc3RpbmN0X2luY2lkZW50c19xdWVyeSA9IGRlbWlzdG8uYXJncygpLmdldCgicXVlcnkiKQogICAgZGlzdGluY3RfaW5jaWRlbnRzID0gZGVtaXN0by5hcmdzKCkuZ2V0KCJpbmNpZGVudHNfZGlzdGluY3Rpb25fbmFtZSIpCiAgICBmcm9tX2RhdGUgPSBkZW1pc3RvLmFyZ3MoKS5nZXQoJ2Zyb20nKQogICAgZ3JvdXBzID0gZ2VuZXJhdGVfZ3JvdXBzKGZlZWRfdHlwZXMsIGZyb21fZGF0ZSwgZGlzdGluY3RfaW5jaWRlbnRzX3F1ZXJ5LCBkaXN0aW5jdF9pbmNpZGVudHMpCiAgICBodW1hbl9yZWFkYWJsZSA9IHRhYmxlVG9NYXJrZG93bignSW5jaWRlbnRzIGNvdW50IGJ5IGZlZWQnLCBncm91cHMpCiAgICBkZW1pc3RvLnJlc3VsdHMoewogICAgICAgICdUeXBlJzogZW50cnlUeXBlc1snbm90ZSddLAogICAgICAgICdDb250ZW50cyc6IGdyb3VwcywKICAgICAgICAnQ29udGVudHNGb3JtYXQnOiBmb3JtYXRzWyd0ZXh0J10sCiAgICAgICAgJ1JlYWRhYmxlQ29udGVudHNGb3JtYXQnOiBmb3JtYXRzWydtYXJrZG93biddLAogICAgICAgICdIdW1hblJlYWRhYmxlJzogaHVtYW5fcmVhZGFibGUKICAgIH0pCgoKZGVmIGdlbmVyYXRlX2dyb3VwcyhmZWVkX3R5cGVzLAogICAgICAgICAgICAgICAgICAgIGZyb21fZGF0ZSwKICAgICAgICAgICAgICAgICAgICBkaXN0aW5jdF9pbmNpZGVudHNfcXVlcnk9Tm9uZSwKICAgICAgICAgICAgICAgICAgICBkaXN0aW5jdGlvbl9uYW1lPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgKSAtPiBMaXN0W0RpY3Rbc3RyLCBVbmlvbltMaXN0W0RpY3Rbc3RyLCBVbmlvbltzdHIsIExpc3RbaW50XV1dXSwgc3RyXV1dOgogICAgIiIiSWYgZGlzdGluY3RfaW5jaWRlbnRzX3F1ZXJ5IGlzIGdpdmVuLSByZXR1cm4gdGhlIGFtb3VudCBvZiBpbmNpZGVudHMgdGhhdCBtYXRjaCB0aGUgcXVlcnkgYW5kIHRoZSBhbW91bnQgb2YKICAgIHRoZSByZW1haW5pbmcgaW5jaWRlbnRzIHRoYXQgaGFzIGluZGljYXRvcnMgZnJvbSB0aG9zZSBmZWVkcy4KICAgIElmIGRpc3RpbmN0X2luY2lkZW50c19xdWVyeSBpcyBub3QgZ2l2ZW4tIHdpbGwgb25seSByZXR1cm4gdGhlIGFtb3VudAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgICAgIGZlZWRfdHlwZXMgOkEgZGljdCBDb250YWluaW5nIGZlZWQgbmFtZXMKICAgICAgICAgICAgICAgZGlzdGluY3RfaW5jaWRlbnRzX3F1ZXJ5OiBBIHN0cmluZyB3aXRoIGFkZGl0aW9uYWwgaW5jaWRlbnRzIHF1ZXJ5CiAgICAgICAgICAgICAgIGRpc3RpbmN0X2luY2lkZW50c19uYW1lOiBBIHN0cmluZyB3aXRoIHRoZSBkaXN0aW5jdGlvbiBuYW1lIHRvIGRpc3BsYXkgaW4gdGhlIHdpZGdldAogICAgICAgIEByZXR1cm46CiAgICAgICAgICAgIENoYXJ0IHdpZGdldCByZXF1aXJlIGxpc3Qgb2YgJ2dyb3VwJyBhcyByZXNwb25zZQogICAgICAgd2hlcmUgZ3JvdXAgaGFzICJuYW1lIjogc3RyaW5nLCAiZGF0YSIgW2ludF0sICJncm91cHMiOiBbZ3JvdXBdCiAgICAgICAgIiIiCiAgICBkYXRhID0ge30KICAgIGZvciBmZWVkIGluIGZlZWRfdHlwZXM6CiAgICAgICAgaW5jaWRlbnRzX2NvdW50X2J5X2ZlZWQgPSBnZXRfaW5jaWRlbnRzX2NvdW50X2J5X2ZlZWQoZmVlZCwgZnJvbV9kYXRlKQogICAgICAgIGRpc3RpbmN0X2luY2lkZW50c19jb3VudCA9IGdldF9pbmNpZGVudHNfY291bnRfYnlfZmVlZChmZWVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tX2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RpbmN0X2luY2lkZW50c19xdWVyeSkgaWYgZGlzdGluY3RfaW5jaWRlbnRzX3F1ZXJ5IGVsc2UgMAogICAgICAgIGRhdGFbZmVlZF0gPSBbeyJuYW1lIjogIkluY2lkZW50cyIsICJkYXRhIjogW2luY2lkZW50c19jb3VudF9ieV9mZWVkIC0gZGlzdGluY3RfaW5jaWRlbnRzX2NvdW50XX1dCiAgICAgICAgaWYgZGlzdGluY3Rpb25fbmFtZToKICAgICAgICAgICAgZGF0YVtmZWVkXS5hcHBlbmQoeyJuYW1lIjogZGlzdGluY3Rpb25fbmFtZSwgImRhdGEiOiBbZGlzdGluY3RfaW5jaWRlbnRzX2NvdW50XX0pCgogICAgZ3JvdXBzID0gW10KICAgIGZvciBrZXksIHZhbHVlIGluIGRhdGEuaXRlbXMoKToKICAgICAgICBncm91cHMuYXBwZW5kKHsibmFtZSI6IGtleSwKICAgICAgICAgICAgICAgICAgICAgICAiZ3JvdXBzIjogdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgcmV0dXJuIGdyb3VwcwoKCmlmIF9fbmFtZV9fIGluICgnX19tYWluX18nLCAnX19idWlsdGluX18nLCAnYnVpbHRpbnMnKToKICAgIG1haW4oKQ==
subtype: python3
system: false
tags:
  - widget
timeout: '0'
type: python
dockerimage: demisto/python3:3.8.1.5734
runas: DBotWeakRole
runonce: false
dependson:
  must:
    - getIncidents
